<!DOCTYPE html>
<html>
<head>
    <title>Lab 5 | D3</title>
    <script src="https://d3js.org/d3.v7.min.js" charset="utf-8"></script>
    <!-- Include the roads and buildings data -->
    <script src="https://zhixincao1.github.io/lab5/roads.js"></script>
    <script src="https://zhixincao1.github.io/lab5/buildings.js"></script>
    <style>
        body {
            position: absolute;
            font-family: "Proxima Nova", "Montserrat", sans-serif;
        }
        h1, h2 {
            position: absolute;
            background: white;
            left: 10px;
            font-size: 1.3em;
            font-weight: 100;
        }
        h2 {
            top: 30px;
            font-size: 1em;
        }
        .hover {
            fill: yellow;   
        }
        #sliderContainer {
            text-align: center;
            position: fixed;
            right: 10px;
            top: 700px;
        }
    </style>
</head>
<body>
    <h1>Age of Greater Hyde Park Buildings</h1>
    <h2></h2>
    <div id="sliderContainer">
        <input id="timeslide" type="range" min="0" max="149" value="0" step="1"/><br>
        <span id="range">1861</span>
    </div>

    <script>
        var width = 1300; // Increased from 1000
        var height = 780; // Increased from 600

        var svg = d3.select("body")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);

        var g = svg.append("g");

        var albersProjection = d3.geoAlbers()
                                .scale(945000) // Reduced scale to zoom out
                                .rotate([87.596305043, 0])
                                .center([0, 41.79503802])
                                .translate([width / 2, height / 2]);

        var geoPath = d3.geoPath()
                        .projection(albersProjection);

        // Using the roads data
        g.selectAll("path")
            .data(roads.features)
            .enter()
            .append("path")
            .attr("fill", "#ccc")
            .attr("stroke", "#333")
            .attr("d", geoPath);

        var buildingsLayer = svg.append("g");

        // Using the new buildings data
        buildingsLayer.selectAll("path")
            .data(buildings.features)
            .enter()
            .append("path")
            .attr("fill", "#900")
            .attr("stroke", "#999")
            .attr("d", geoPath)
            .attr("class", "buildingdata")
            .on("mouseover", function(event, d) {
                d3.select("h2").text("Built in " + d.properties.YEAR_BUILT);
                d3.select(this).attr("class", "buildingdata hover");
            })
            .on("mouseout", function(d) {
                d3.select("h2").text("");
                d3.select(this).attr("class", "buildingdata");
            });

        var years = [
            "1861", "1862", "1863", "1864", "1865", "1866", "1867", "1868", "1869", "1870",
            "1871", "1872", "1873", "1874", "1875", "1876", "1877", "1878", "1879", "1880",
            "1881", "1882", "1883", "1884", "1885", "1886", "1887", "1888", "1889", "1890",
            "1891", "1892", "1893", "1894", "1895", "1896", "1897", "1898", "1899", "1900",
            "1901", "1902", "1903", "1904", "1905", "1906", "1907", "1908", "1909", "1910",
            "1911", "1912", "1913", "1914", "1915", "1916", "1917", "1918", "1919", "1920",
            "1921", "1922", "1923", "1924", "1925", "1926", "1927", "1928", "1929", "1930",
            "1931", "1932", "1933", "1934", "1935", "1936", "1937", "1938", "1939", "1940",
            "1941", "1942", "1943", "1944", "1945", "1946", "1947", "1948", "1949", "1950",
            "1951", "1952", "1953", "1954", "1955", "1956", "1957", "1958", "1959", "1960",
            "1961", "1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970",
            "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980",
            "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990",
            "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000",
            "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010"
        ];

        var inputValue = null;

        d3.select("#timeslide").on("input", function() {
            update(+this.value);
        });

        function update(value) {
            document.getElementById("range").innerHTML = years[value];
            inputValue = years[value];
            d3.selectAll(".buildingdata")
                .attr("fill", dateMatch);
        }

        function dateMatch(data, value) {
            var y = data.properties.YEAR_BUILT.toString();
            if (inputValue === y) {
                this.parentElement.appendChild(this);
                return "yellow";
            } else {
                return "#999";
            }
        }
    </script>
</body>
</html>
